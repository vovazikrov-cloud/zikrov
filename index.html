<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X-Mas Acc Store</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { 
            background: radial-gradient(circle at top, #1a472a, #0d1b11); 
            color: white; 
            font-family: 'Montserrat', sans-serif;
            min-height: 100vh;
        }
        .snow-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; background: url('https://www.transparenttextures.com/patterns/stardust.png');
            z-index: 0;
        }
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; }
        .btn-gold { background: linear-gradient(45deg, #d4af37, #f9e27d); color: #2d2d2d; border: none; }
        .tab-btn.active { color: #d4af37; border-bottom: 2px solid #d4af37; }
        .admin-input { background: rgba(0,0,0,0.3); border: 1px solid rgba(212, 175, 55, 0.3); border-radius: 10px; padding: 10px; width: 100%; color: white; margin-bottom: 8px; }
    </style>
</head>
<body class="p-4">
    <div class="snow-bg"></div>

    <nav class="relative z-10 flex justify-around mb-6 glass p-3 text-xs font-bold uppercase tracking-widest">
        <button onclick="showTab('shop')" id="tab-shop" class="tab-btn active">–ú–∞–≥–∞–∑–∏–Ω</button>
        <button onclick="showTab('profile')" id="tab-profile" class="tab-btn">–ü—Ä–æ—Ñ–∏–ª—å</button>
        <button onclick="checkAdmin()" id="tab-admin" class="tab-btn text-red-400">–ê–¥–º–∏–Ω</button>
    </nav>

    <div id="app" class="relative z-10 pb-20">
        
        <section id="view-shop">
            <div class="text-center mb-6">
                <h1 class="text-3xl font-bold text-yellow-500 drop-shadow-lg">Happy New Year! ‚ùÑÔ∏è</h1>
                <p class="text-xs opacity-70">–õ—É—á—à–∏–µ –∞–∫–∫–∞—É–Ω—Ç—ã –∫ –ø—Ä–∞–∑–¥–Ω–∏–∫–∞–º</p>
            </div>
            <div id="categories-container" class="space-y-6"></div>
        </section>

        <section id="view-profile" class="hidden">
            <div class="glass p-6 text-center">
                <div class="w-20 h-20 bg-yellow-500 rounded-full mx-auto mb-4 border-4 border-white/20 flex items-center justify-center text-3xl">üéÖ</div>
                <h2 id="user-name" class="text-xl font-bold mb-1">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</h2>
                <div class="grid grid-cols-2 gap-4 mt-6">
                    <div class="bg-black/20 p-3 rounded-xl"><p class="text-[10px] opacity-50">–ü–æ–∫—É–ø–æ–∫</p><p id="stat-count" class="text-xl font-bold">0</p></div>
                    <div class="bg-black/20 p-3 rounded-xl"><p class="text-[10px] opacity-50">–°—É–º–º–∞</p><p id="stat-spent" class="text-xl font-bold text-yellow-500">0 ‚ÇΩ</p></div>
                </div>
            </div>
        </section>

        <section id="view-admin" class="hidden">
            <div class="glass p-4 border-red-500/30 border">
                <h2 class="text-xl font-bold text-red-400 mb-4 flex justify-between items-center">
                    –ü–∞–Ω–µ–ª—å –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞ 
                    <button onclick="showTab('shop')" class="text-xs text-white bg-white/10 px-2 py-1 rounded">–í—ã—Ö–æ–¥</button>
                </h2>
                
                <div class="mb-6 pb-6 border-b border-white/10">
                    <h3 class="text-sm font-bold mb-2">–°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h3>
                    <input id="new-cat-name" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä. Telegram USA)" class="admin-input">
                    <button onclick="addCategory()" class="w-full btn-gold py-2 rounded-lg font-bold">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                </div>

                <div id="admin-cats-list" class="space-y-4"></div>
                
                <div class="mt-6 p-3 bg-black/40 rounded-lg">
                    <h3 class="text-xs mb-2 text-yellow-500">–†–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã:</h3>
                    <input id="adm-pay-details" type="text" class="admin-input text-xs" onchange="updatePayDetails(this.value)">
                </div>
            </div>
        </section>

        <section id="view-pay" class="hidden animate-fade-in">
            <div class="glass p-6">
                <h2 class="text-2xl font-bold mb-2">–û–ø–ª–∞—Ç–∞</h2>
                <p id="pay-item-name" class="text-yellow-500 mb-4"></p>
                <div class="bg-black/50 p-4 rounded-xl mb-6 border border-white/10">
                    <p class="text-[10px] opacity-50 mb-1">–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –Ω–∞:</p>
                    <p id="pay-rekv" class="font-mono font-bold select-all"></p>
                </div>
                <div class="mb-6">
                    <p class="text-xs mb-2">üì∏ –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞:</p>
                    <input type="file" id="screenshot-file" class="text-xs block w-full text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-yellow-500 file:text-black">
                </div>
                <button onclick="finishOrder()" class="w-full btn-gold py-4 rounded-xl font-bold text-lg shadow-[0_0_20px_rgba(212,175,55,0.3)]">–Ø –û–ü–õ–ê–¢–ò–õ, –û–¢–ü–†–ê–í–ò–¢–¨</button>
            </div>
        </section>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const ADMIN_USERNAME = 'z1krov'; 
        let currentItem = null;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
        let db = JSON.parse(localStorage.getItem('xmas_db')) || {
            categories: [],
            payDetails: '+79009389328 (–°–ë–ü)',
            adminPass: '2020'
        };
        let stats = JSON.parse(localStorage.getItem('xmas_stats')) || { count: 0, spent: 0 };

        function save() { localStorage.setItem('xmas_db', JSON.stringify(db)); }
        function saveStats() { localStorage.setItem('xmas_stats', JSON.stringify(stats)); }

        function showTab(tab) {
            document.querySelectorAll('#app > section').forEach(s => s.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(`view-${tab}`).classList.remove('hidden');
            document.getElementById(`tab-${tab}`).classList.add('active');
            render();
        }

        function checkAdmin() {
            const pass = prompt("–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞:");
            if (pass === db.adminPass) showTab('admin');
            else alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!");
        }

        function addCategory() {
            const name = document.getElementById('new-cat-name').value;
            if(!name) return;
            db.categories.push({ id: Date.now(), name: name, items: [] });
            save(); render();
            document.getElementById('new-cat-name').value = '';
        }

        function addItem(catId) {
            const name = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞:");
            const price = prompt("–¶–µ–Ω–∞ (—á–∏—Å–ª–æ):");
            if(name && price) {
                const cat = db.categories.find(c => c.id === catId);
                cat.items.push({ id: Date.now(), name, price: Number(price) });
                save(); render();
            }
        }

        function deleteItem(catId, itemId) {
            const cat = db.categories.find(c => c.id === catId);
            cat.items = cat.items.filter(i => i.id !== itemId);
            save(); render();
        }

        function updatePayDetails(val) { db.payDetails = val; save(); }

        function openPay(catName, itemName, price) {
            currentItem = { catName, itemName, price };
            document.getElementById('pay-item-name').innerText = `${itemName} ‚Äî ${price} ‚ÇΩ`;
            document.getElementById('pay-rekv').innerText = db.payDetails;
            showTab('pay');
        }

        function finishOrder() {
            const fileInput = document.getElementById('screenshot-file');
            if (!fileInput.files[0]) return alert("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞!");

            stats.count++;
            stats.spent += currentItem.price;
            saveStats();

            const text = `üéÑ –ù–û–í–´–ô –ó–ê–ö–ê–ó%0A---%0Aüì¶ –¢–æ–≤–∞—Ä: ${currentItem.itemName}%0AüìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${currentItem.catName}%0Aüí∞ –°—É–º–º–∞: ${currentItem.price} ‚ÇΩ%0A---%0A–°–∫—Ä–∏–Ω—à–æ—Ç –ø—Ä–∏–∫—Ä–µ–ø–ª—è—é –Ω–∏–∂–µ:`;
            tg.openTelegramLink(`https://t.me/${ADMIN_USERNAME}?text=${encodeURIComponent(text)}`);
            tg.close();
        }

        function render() {
            // –ú–∞–≥–∞–∑–∏–Ω
            const shop = document.getElementById('categories-container');
            shop.innerHTML = db.categories.map(cat => `
                <div>
                    <h3 class="text-yellow-500 font-bold mb-3 flex items-center"><span class="mr-2">‚ùÑÔ∏è</span> ${cat.name}</h3>
                    <div class="grid gap-3">
                        ${cat.items.map(item => `
                            <div class="glass p-4 flex justify-between items-center active:scale-95 transition" onclick="openPay('${cat.name}', '${item.name}', ${item.price})">
                                <div><p class="font-bold text-sm">${item.name}</p></div>
                                <div class="bg-yellow-500/20 px-3 py-1 rounded-full text-yellow-500 font-bold text-sm">${item.price} ‚ÇΩ</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');

            // –ê–¥–º–∏–Ω–∫–∞
            const admin = document.getElementById('admin-cats-list');
            admin.innerHTML = db.categories.map(cat => `
                <div class="bg-white/5 p-3 rounded-xl">
                    <div class="flex justify-between font-bold text-sm mb-2">
                        <span>${cat.name}</span>
                        <button onclick="addItem(${cat.id})" class="text-green-400">+ –¢–æ–≤–∞—Ä</button>
                    </div>
                    <div class="space-y-1">
                        ${cat.items.map(item => `
                            <div class="text-xs flex justify-between opacity-70">
                                <span>${item.name} (${item.price}‚ÇΩ)</span>
                                <button onclick="deleteItem(${cat.id}, ${item.id})" class="text-red-500">–£–¥–∞–ª–∏—Ç—å</button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');

            // –ü—Ä–æ—Ñ–∏–ª—å
            document.getElementById('stat-count').innerText = stats.count;
            document.getElementById('stat-spent').innerText = stats.spent + ' ‚ÇΩ';
            document.getElementById('user-name').innerText = tg.initDataUnsafe?.user?.first_name || '–°—á–∞—Å—Ç–ª–∏–≤—ã–π –∫–ª–∏–µ–Ω—Ç';
            document.getElementById('adm-pay-details').value = db.payDetails;
        }

        render();
    </script>
</body>
</html>






