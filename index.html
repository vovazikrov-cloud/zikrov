<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MonoStore Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --accent: #ffffff; }
        body { background-color: #000; color: #fff; font-family: 'Inter', sans-serif; overflow: hidden; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .btn-primary { background: var(--accent); color: #000; font-weight: 900; }
        #snow { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 1; }
        .nav-active { color: var(--accent); opacity: 1 !important; }
        .view { animation: slideUp 0.3s ease-out; height: 80vh; overflow-y: auto; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        input { background: #111 !important; border: 1px solid #222 !important; color: white !important; border-radius: 14px; }
        ::-webkit-scrollbar { width: 0; }
    </style>
</head>
<body>
    <canvas id="snow"></canvas>

    <div class="relative z-10 flex flex-col h-screen px-6 pt-8">
        
        <header class="flex justify-between items-end mb-10">
            <div>
                <h1 class="text-4xl font-black tracking-tighter italic uppercase leading-none">MONO</h1>
                <p class="text-[9px] tracking-[0.4em] opacity-30 uppercase mt-1">Digital Distribution</p>
            </div>
            <div id="avatar" class="w-10 h-10 rounded-full border border-white/10 overflow-hidden bg-zinc-900"></div>
        </header>

        <main class="flex-1">
            <section id="view-shop" class="view space-y-10">
                <div id="shop-data" class="space-y-8 pb-32">
                    <div class="text-center py-20 opacity-10 text-[10px] tracking-widest uppercase">Загрузка системы...</div>
                </div>
            </section>

            <section id="view-profile" class="view hidden space-y-6">
                <div class="glass p-8 rounded-[32px]">
                    <p class="text-[10px] uppercase opacity-30 mb-8 tracking-widest">User Intelligence</p>
                    <div class="flex justify-between items-end">
                        <div><p class="text-5xl font-black tracking-tighter" id="st-count">0</p><p class="text-[9px] opacity-30 uppercase font-bold mt-1">Orders</p></div>
                        <div class="text-right"><p class="text-3xl font-black tracking-tighter text-zinc-500" id="st-spent">0</p><p class="text-[9px] opacity-30 uppercase font-bold mt-1">Spent (RUB)</p></div>
                    </div>
                </div>
                <div class="glass p-6 rounded-[32px]">
                    <p class="text-[10px] uppercase opacity-20 mb-4 tracking-widest">Interface Accent</p>
                    <div class="flex justify-between" id="color-picker"></div>
                </div>
            </section>

            <section id="view-admin" class="view hidden space-y-6 pb-32">
                <div class="flex justify-between items-center bg-zinc-900 p-4 rounded-2xl">
                    <span class="text-[10px] font-black uppercase opacity-50">Cloud Database</span>
                    <button onclick="syncToCloud()" class="bg-white text-black text-[9px] px-4 py-2 rounded-full font-black uppercase tracking-tighter">Sync Now</button>
                </div>
                
                <div class="glass p-6 rounded-[32px] space-y-4">
                    <input id="adm-c-name" type="text" placeholder="Category Name" class="w-full text-sm">
                    <button onclick="addCategory()" class="w-full btn-primary p-4 rounded-2xl text-[10px] uppercase">Create Category</button>
                </div>

                <div id="adm-list" class="space-y-4"></div>

                <div class="glass p-6 rounded-[32px]">
                    <p class="text-[10px] opacity-30 mb-4 uppercase">Payment Details</p>
                    <input id="adm-rekv" type="text" onchange="db.rekv = this.value" class="w-full text-sm">
                </div>
            </section>

            <section id="view-pay" class="view hidden">
                <div class="flex flex-col h-full justify-center pb-20">
                    <div class="text-center mb-10">
                        <p class="text-[10px] uppercase opacity-30 tracking-[0.5em] mb-2">Checkout</p>
                        <h2 id="p-item" class="text-4xl font-black tracking-tighter italic uppercase"></h2>
                        <p id="p-price" class="text-xl font-light opacity-50 mt-2"></p>
                    </div>
                    
                    <div class="glass p-8 rounded-[40px] mb-8">
                        <p class="text-[9px] uppercase opacity-20 mb-4 tracking-widest text-center">Transfer Funds To</p>
                        <p id="p-rekv" class="font-mono text-center text-lg font-bold break-all select-all"></p>
                    </div>

                    <button onclick="sendOrder()" class="w-full btn-primary py-6 rounded-[30px] text-xs uppercase tracking-[0.2em]">I Have Paid</button>
                    <button onclick="swView('shop')" class="w-full mt-4 text-[10px] uppercase opacity-30 font-bold">Cancel</button>
                </div>
            </section>
        </main>

        <nav class="fixed bottom-10 left-8 right-8 h-16 glass rounded-full flex justify-around items-center px-4 z-50">
            <button onclick="swView('shop')" id="n-shop" class="nav-active opacity-30 transition-all scale-110"><span class="text-[10px] font-black uppercase">Market</span></button>
            <button onclick="swView('profile')" id="n-profile" class="opacity-30 transition-all"><span class="text-[10px] font-black uppercase">Info</span></button>
            <button onclick="swView('admin')" id="n-admin" class="hidden opacity-30 text-zinc-500"><span class="text-[10px] font-black uppercase tracking-tighter">Root</span></button>
        </nav>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- CONFIGURATION ---
        const CONFIG = {
            ADMIN_ID: 1577146268, // Твой Telegram ID
            ADMIN_USERNAME: 'z1krov', // Твой ник без @
            JSONBIN_KEY: '$2a$10$ВашКлюч', // Master Key от JSONBin
            JSONBIN_ID: 'ВашBinID' // Bin ID
        };

        let db = { categories: [], rekv: "Not Set" };
        let stats = JSON.parse(localStorage.getItem('m_stats')) || { count: 0, spent: 0 };
        let accent = localStorage.getItem('m_accent') || '#ffffff';
        let activeItem = null;

        async function loadFromCloud() {
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.JSONBIN_ID}/latest`, {
                    headers: { 'X-Master-Key': CONFIG.JSONBIN_KEY, 'X-Bin-Meta': false }
                });
                db = await res.json();
                render();
            } catch (e) { console.error("Cloud Error"); }
        }

        async function syncToCloud() {
            tg.MainButton.setText("UPLOADING...").show();
            try {
                await fetch(`https://api.jsonbin.io/v3/b/${CONFIG.JSONBIN_ID}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'X-Master-Key': CONFIG.JSONBIN_KEY },
                    body: JSON.stringify(db)
                });
                tg.showAlert("Cloud Database Updated Successfully.");
            } catch (e) { alert("Sync Failed."); }
            tg.MainButton.hide();
        }

        function swView(v) {
            document.querySelectorAll('.view').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('nav button').forEach(el => {
                el.classList.remove('nav-active');
                el.style.transform = 'scale(1)';
            });
            document.getElementById(`view-${v}`).classList.remove('hidden');
            document.getElementById(`n-${v}`).classList.add('nav-active');
            document.getElementById(`n-${v}`).style.transform = 'scale(1.1)';
            render();
        }

        function render() {
            document.documentElement.style.setProperty('--accent', accent);
            if (tg.initDataUnsafe?.user?.id === CONFIG.ADMIN_ID) document.getElementById('n-admin').classList.remove('hidden');

            const shop = document.getElementById('shop-data');
            shop.innerHTML = db.categories.length ? db.categories.map(cat => `
                <div>
                    <h3 class="text-[9px] uppercase tracking-[0.6em] opacity-20 mb-6 pl-2">${cat.name}</h3>
                    <div class="grid gap-4">
                        ${cat.items.map(i => `
                            <div onclick="openPay('${cat.name}', '${i.name}', ${i.price})" class="glass p-6 rounded-[30px] flex justify-between items-center active:bg-white active:text-black transition-all">
                                <div><h4 class="font-black text-sm uppercase italic tracking-tighter">${i.name}</h4><p class="text-[8px] opacity-40 uppercase tracking-widest mt-1">Stock: 24/7 Delivery</p></div>
                                <div class="font-black text-sm">${i.price} ₽</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('') : '<div class="text-center opacity-10 py-20 text-[10px] tracking-widest">NO ASSETS FOUND</div>';

            const admList = document.getElementById('adm-list');
            admList.innerHTML = db.categories.map(cat => `
                <div class="bg-zinc-900/50 p-5 rounded-[24px] border border-white/5">
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-[9px] font-bold uppercase opacity-40">${cat.name}</span>
                        <div class="flex gap-2">
                            <button onclick="addItem(${cat.id})" class="bg-white text-black px-3 py-1 rounded-full text-[9px] font-black">+</button>
                            <button onclick="delCat(${cat.id})" class="bg-zinc-800 text-white px-3 py-1 rounded-full text-[9px] font-black">×</button>
                        </div>
                    </div>
                    <div class="space-y-2">
                        ${cat.items.map(i => `<div class="flex justify-between text-[10px] opacity-40 italic"><span>${i.name}</span><button onclick="delItem(${cat.id}, ${i.id})" class="text-red-900 underline">Remove</button></div>`).join('')}
                    </div>
                </div>
            `).join('');

            document.getElementById('st-count').innerText = stats.count;
            document.getElementById('st-spent').innerText = stats.spent;
            document.getElementById('adm-rekv').value = db.rekv;
        }

        function openPay(c, n, p) {
            activeItem = { c, n, p };
            document.getElementById('p-item').innerText = n;
            document.getElementById('p-price').innerText = p + ' ₽';
            document.getElementById('p-rekv').innerText = db.rekv;
            swView('pay');
        }

        function sendOrder() {
            stats.count++;
            stats.spent += activeItem.p;
            localStorage.setItem('m_stats', JSON.stringify(stats));

            // Чистый текст сообщения
            const n = "\n";
            const message = `ORDER REPORT${n}${n}Asset: ${activeItem.n}${n}Value: ${activeItem.p} RUB${n}${n}Account: ${tg.initDataUnsafe?.user?.first_name || 'Anonymous'}`;
            
            tg.openTelegramLink(`https://t.me/${CONFIG.ADMIN_USERNAME}?text=${encodeURIComponent(message)}`);
            tg.close();
        }

        // --- ADMIN LOGIC ---
        function addCategory() {
            const val = document.getElementById('adm-c-name').value;
            if(!val) return;
            db.categories.push({ id: Date.now(), name: val, items: [] });
            document.getElementById('adm-c-name').value = '';
            render();
        }
        function addItem(cid) {
            const n = prompt("Item Name:");
            const p = prompt("Price (Number):");
            if(n && p) {
                db.categories.find(c => c.id === cid).items.push({ id: Date.now(), name: n, price: Number(p) });
                render();
            }
        }
        function delCat(id) { db.categories = db.categories.filter(c => c.id !== id); render(); }
        function delItem(cid, iid) { 
            const cat = db.categories.find(c => c.id === cid);
            cat.items = cat.items.filter(i => i.id !== iid);
            render(); 
        }

        // --- SNOW ---
        const canv = document.getElementById('snow');
        const ctx = canv.getContext('2d');
        let parts = [];
        function initSnow() {
            canv.width = window.innerWidth; canv.height = window.innerHeight;
            parts = Array.from({length: 40}, () => ({ x: Math.random()*canv.width, y: Math.random()*canv.height, r: Math.random()*1.5, s: Math.random()*0.3+0.1 }));
        }
        function drawSnow() {
            ctx.clearRect(0,0,canv.width,canv.height);
            ctx.fillStyle = "rgba(255,255,255,0.15)";
            ctx.beginPath();
            parts.forEach(p => { ctx.moveTo(p.x, p.y); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); p.y += p.s; if(p.y > canv.height) p.y = -5; });
            ctx.fill();
            requestAnimationFrame(drawSnow);
        }

        const colors = ['#ffffff', '#ff3b30', '#4cd964', '#007aff', '#ff9500', '#af52de'];
        document.getElementById('color-picker').innerHTML = colors.map(c => `<button onclick="accent='${c}';localStorage.setItem('m_accent','${c}');render()" class="w-8 h-8 rounded-full border border-white/10" style="background:${c}"></button>`).join('');
        
        window.addEventListener('resize', initSnow);
        initSnow(); drawSnow(); loadFromCloud();

        if(tg.initDataUnsafe?.user?.photo_url) {
            document.getElementById('avatar').innerHTML = `<img src="${tg.initDataUnsafe.user.photo_url}" class="w-full h-full object-cover rounded-xl opacity-50">`;
        }
    </script>
</body>
</html>

